{% extends 'base.html' %}

{% block content %}
<div class="goal-detail">
    <h1>{{ goal.title }}</h1>

    <div class="goal-info">
        <p class="goal-description">{{ goal.description }}</p>
        <div class="goal-meta">
            <span><strong>üìÖ –î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</strong> {{ goal.target_date }}</span>
            <span class="status {% if goal.is_completed %}completed{% else %}in-progress{% endif %}">
                <strong>–°—Ç–∞—Ç—É—Å:</strong>
                {% if goal.is_completed %}‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ{% else %}üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ{% endif %}
            </span>
        </div>
    </div>

    <div class="goal-actions">
        {% if not goal.is_completed %}
            <form method="post" action="{% url 'complete_goal' goal.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π</button>
            </form>
        {% else %}
            <form method="post" action="{% url 'reopen_goal' goal.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning">üîÑ –í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>
            </form>
        {% endif %}
        <a href="{% url 'index' %}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É —Ü–µ–ª–µ–π</a>
    </div>

    <h2>üìù –®–∞–≥–∏ —Ü–µ–ª–∏</h2>

    {% if goal.steps.all %}
        <div class="steps-list">
            {% for step in goal.steps.all %}
                <div class="step-item {% if step.is_completed %}completed{% endif %}">
                    <div class="step-header">
                        <h3>{{ step.title }}</h3>
                        <span class="step-status">
                            {% if step.is_completed %}‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ{% else %}‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ{% endif %}
                        </span>
                    </div>
                    {% if step.description %}
                        <p class="step-description">{{ step.description }}</p>
                    {% endif %}

                    <form method="post" action="{% url 'toggle_step_status' goal.id step.id %}" style="display: inline;">
                        {% csrf_token %}
                        {% if step.is_completed %}
                            <button type="submit" class="btn btn-outline btn-sm">‚Ü©Ô∏è –í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É</button>
                        {% else %}
                            <button type="submit" class="btn btn-primary btn-sm">‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
                        {% endif %}
                    </form>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <p>–£ —ç—Ç–æ–π —Ü–µ–ª–∏ –ø–æ–∫–∞ –Ω–µ—Ç —à–∞–≥–æ–≤.</p>
            <a href="{% url 'add_step' goal.id %}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —à–∞–≥</a>
        </div>
    {% endif %}

    <div class="add-step-section">
        <a href="{% url 'add_step' goal.id %}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —à–∞–≥</a>
    </div>
</div>

{% endblock %}